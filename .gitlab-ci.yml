image: docker:24.0.5

services:
  - docker:24.0.5-dind

variables:
  DOCKER_HOST: tcp://docker:2376
  DOCKER_TLS_CERTDIR: "/certs"

stages:
  - test

before_script:
  - apk add --no-cache git docker-compose
  - docker info

playwright:
  stage: test
  script:
    - git clone https://github.com/slawekradzyminski/awesome-localstack.git
    - cd awesome-localstack
    - docker-compose up -d
    - cd ..
    - npm ci
    - npx playwright install --with-deps
    - npx playwright test
  after_script:
    - cd awesome-localstack
    - docker-compose down
    - cd ..
  artifacts:
    when: always
    paths:
      - playwright-report/
    expire_in: 1 day